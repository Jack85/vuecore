<#@ template debug="false" hostspecific="true" language="C#" #>
<#@ import namespace="Newtonsoft.Json" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ import namespace="System" #>
<#@ import namespace="System.IO" #>
<#@ import namespace="System.Linq" #>
<#@ import namespace="Microsoft.AspNetCore.Mvc.ApiExplorer" #>
<#@ import namespace="System.Reflection" #>
<#@ import namespace="Microsoft.AspNetCore.Mvc" #>
<#@ import namespace="System.Text.RegularExpressions" #>
<#@ import namespace="System.Threading.Tasks" #>
<#@ import namespace="System.Reflection" #>
<#@ import namespace="System.Runtime" #>
<#@ import namespace="System.Xml" #>
<#@ import namespace="System.Xml.Linq" #>
<#@ Assembly name="EnvDTE" #>
<#@ output extension=".ts" #>
<# /* Environment.CurrentDirectory */ #><#
string assemblyName = "vuecore.dll";
string assemblyPath = Environment.CurrentDirectory + "\\bin\\Debug\\netcoreapp2.0\\"+assemblyName;
//string[] namespaces = new string[]{ "bVue.code.controllers","bVue.code"};
#><# /*= assemblyPath*/ #><#
Assembly assembly = Assembly.LoadFrom(assemblyPath);

List<Type> types = new List<Type>();
//foreach(var s in namespaces){
 types = types.Concat(GetTypesInNamespace(assembly, "")).ToList();
//}
#>

//AUTOGENERATED DO NOT EDIT THIS FILE <#= DateTime.Now.ToString() #>
////////////////////
// available hubs //
////////////////////
//#region available hubs
//JS header:


declare var $:any;
import fetchival from 'fetchival';

export class Api {
<#
foreach (var hub in types)
{
	string hName = GetController(hub.Name);
#>

    /** * The hub implemented by <#=hub.FullName#>    */
  public  <#= hub.Name!=null?hName:hName #> : <#= hub.Name #> = new <#= hub.Name #>();	 
<#
}
#>
}
//#endregion available hubs
<#
foreach (var hub in types)
{
	string hName = GetController(hub.Name);
#>

    /** * The hub implemented by <#=hub.FullName#>    */
  export class   <#= hub.Name #>
  {

      public hello(search:string):Promise<string>
      {  //todo parametrize and make more dynamic
          return fetchival('http://localhost:5000/test/hello', { 
                headers: { 'Content-Type': 'application/json', token:'yourcookie' }    
                }).get({    
                    search:search	
                    });
         }
  }	 
<#
}
#>

export default Api;
//#endregion data contracts

<#+
	
public Type[] GetTypesInNamespace(Assembly assembly, string nameSpace)
{
    return assembly.GetTypes().Where(t => t.BaseType!=null && t.BaseType.Name.ToLower().EndsWith("controller")
     //&& String.Equals(t.Namespace, nameSpace, StringComparison.Ordinal)
     ).ToArray();
}
	private string GetController(string s)
    {
        return s.Replace("Controller","", StringComparison.InvariantCultureIgnoreCase);
    }

  

#>